CREATE TABLE t1 (c1 INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;
INSERT INTO t1 VALUES (0);
INSERT INTO t1 VALUES (10);
connect con1,localhost,root,,test;
connect con2,localhost,root,,test;

# On connection 1
connection con1;
include/start_transaction_high_prio.inc
START TRANSACTION /* HIGH PRIORITY */;
UPDATE t1 SET c1=1 WHERE c1=0;

# On connection 2
connection con2;
include/start_transaction_high_prio.inc
START TRANSACTION /* HIGH PRIORITY */;
UPDATE t1 SET c1=12 WHERE c1=10;

# On connection 1
connection con1;
# Send
UPDATE t1 SET c1=11 WHERE c1=10;;

# On connection 2
connection con2;
UPDATE t1 SET c1=2 WHERE c1=0;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
disconnect con2;

# On connection 1
connection con1;
# Reap UPDATE t1 SET c1=11 WHERE c1=10
COMMIT;
disconnect con1;
connection default;
include/assert.inc ['There is a 1 in t1']
include/assert.inc ['There is no 2 in t1']
include/assert.inc ['There is no 0 in t1']
DROP TABLE t1;
